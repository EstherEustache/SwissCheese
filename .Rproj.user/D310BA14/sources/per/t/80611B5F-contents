%% This Beamer template is based on the one found here: https://github.com/sanhacheong/stanford-beamer-presentation, and edited to be used for Stanford ARM Lab

\documentclass[10pt]{beamer}
%\mode<presentation>{}

\usepackage{media9}
\usepackage{amssymb,amsmath,amsthm,enumerate}
\usepackage[utf8]{inputenc}
\usepackage{array}
\usepackage[parfill]{parskip}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{bm}
\usepackage{amsfonts,amscd}
\usepackage[]{units}
\usepackage{listings}
\usepackage{multicol,multirow}
\usepackage{tcolorbox}
\usepackage{tikz,tikzsymbols}
\usepackage{xcolor}
\usepackage{apalike}
\usepackage{natbib}
\usepackage{verbatim}

%pour surligner
\usepackage{soul}
\makeatletter
\let\HL\hl
\renewcommand\hl{%
  \let\set@color\beamerorig@set@color
  \let\reset@color\beamerorig@reset@color
  \HL}
\makeatother
%%%%%%%

% Enable colored hyperlinks
%\hypersetup{colorlinks=true}

% The following three lines are for crossmarks & checkmarks
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\ding{51}}%
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}


% Numbered captions of tables, pictures, etc.
\setbeamertemplate{caption}[numbered]

%\usepackage[superscript,biblabel]{cite}
\usepackage{algorithm2e}
\renewcommand{\thealgocf}{}

% Glossary entries
\usepackage[acronym]{glossaries}
\newacronym{ML}{ML}{machine learning}
\newacronym{HRI}{HRI}{human-robot interactions}
\newacronym{RNN}{RNN}{Recurrent Neural Network}
\newacronym{LSTM}{LSTM}{Long Short-Term Memory}


\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\theoremstyle{definition}

\newcommand{\empy}[1]{{\color{darkorange}\emph{#1}}}
\newcommand{\empr}[1]{{\color{cardinalred}\emph{#1}}}
\newcommand{\examplebox}[2]{
\begin{tcolorbox}[colframe=darkcardinal,colback=boxgray,title=#1]
#2
\end{tcolorbox}}

\usetheme{Stanford}
\input{./style_files_stanford/my_beamer_defs.sty}
\logo{\includegraphics[height=0.36in]{./images/logo_double.PNG}}

% commands to relax beamer and subfig conflicts
% see here: https://tex.stackexchange.com/questions/426088/texlive-pretest-2018-beamer-and-subfig-collide
\makeatletter
\let\@@magyar@captionfix\relax
\makeatother





\def\sumku{\hbox{$\sum_{k\in U}$}}
\def\sumks{\hbox{$\sum\limits_{k\in s}$}}
\def\sumksm{\hbox{$\sum\limits_{k\in s_m}$}}
\def\sumksr{\hbox{$\sum\limits_{k\in s_r}$}}
\def\sumlu{\hbox{$\sum\limits_{\ell\in U}$}}
\def\sumls{\hbox{$\sum\limits_{\ell\in s}$}}
\def\sumlsm{\hbox{$\sum\limits_{\ell\in s_m}$}}
\def\sumlsr{\hbox{$\sum\limits_{\ell\in s_r}$}}
\def\sumiu{\hbox{$\sum\limits_{i\in U}$}}
\def\sumis{\hbox{$\sum\limits_{i\in s}$}}
\def\sumisr{\hbox{$\sum\limits_{i\in s_r}$}}
\def\sumju{\hbox{$\sum\limits_{j\in U}$}}




\def\xb{\hbox{$\bf x$}}
\def\wh{\widehat}
\def\psib{\hbox{$\boldsymbol \psi$}}
\def\phib{\hbox{$\boldsymbol \phi$}}



\title[Balanced imputation for swiss cheese
nonresponse]{Balanced imputation for swiss cheese nonresponse}
%\subtitle{Subtitle Of Presentation}

%\beamertemplatenavigationsymbolsempty



\begin{document}

\author[Esther Eustache]{
	\begin{tabular}{c}
	%\Large
	Audrey-Anne VallÃ©e, Esther Eustache and Yves TillÃ©\\
    %\footnotesize \href{mailto:esther.eustache@unine.ch}{esther.eustache@unine.ch}
\end{tabular}
\vspace{-4ex}}

\institute{
	\vskip 1pt
	%Department of Statistics\\
    \textit{University of Neuchatel}\\
    \vskip 10pt
    The Use of R in Official Statistics
	\vskip 3pt
	\begin{figure}
		\centering
		\begin{subfigure}[t]{0.5\textwidth}
			\centering
			\includegraphics[height=0.60in]{./images/uros.jpg}
		\end{subfigure}%
		~
		\begin{subfigure}[t]{0.5\textwidth}
			\centering
			\includegraphics[height=0.70in]{./images/logo_unine_2.png}
		\end{subfigure}
	\end{figure}
}

% \date{June 15, 2020}
\small{\date{\today}}


\begin{noheadline}
\begin{frame}[noframenumbering]
\maketitle
\end{frame}
\end{noheadline}

\setbeamertemplate{itemize items}[default]
\setbeamertemplate{itemize subitem}[circle]

\begin{frame}
	\frametitle{Overview} % Table of contents slide, comment this block out to remove it
	\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

\section{Introduction}
\subsection{Introduction to the nonresponse}
\begin{frame}{The nonresponse}

\only<1>{
\begin{columns}
		\column{.6\linewidth}
		\begin{center}
			\begin{tikzpicture}
			\draw[white][ultra thick] (0,0) ellipse (2.8cm and 1.8cm)
			node[text=blue,right=1cm,below=0cm]  {\Strichmaxerl[2]}
			node[text=blue,right=-1.2cm,below=-0.5cm]  {\Strichmaxerl[2]}
			node[text=blue,right=0cm,below=-1.4cm]  {\Strichmaxerl[2]}
			node[text=blue,right=-0.5cm,below=0.5cm]  {\Strichmaxerl[2]}
			node[text=blue,right=1.5cm,below=-1cm]  {\Strichmaxerl[2]};
			\draw[blue][ultra thick] (-3.5,-2.5) rectangle (3.5,2.5)
			node[text=blue,left=-0.5cm,below=-0.2cm] {$S(n)$}
			node[text=blue,right=-1cm,below=0.2cm]  {\color{blue}\Strichmaxerl[2]}
			node[text=blue,right=-6cm,below=0.4cm]  {\color{blue}\Strichmaxerl[2]}
			node[text=red,right=-6.4cm,below=3.8cm]  {\color{blue}\Strichmaxerl[2]};
			\end{tikzpicture}
		\end{center}
		\column{.4\linewidth}
		\begin{itemize}
			\item[\LARGE\color{blue}\Strichmaxerl] Individual for whom we want to observe $J$ variables to obtain vector ${\bf x}_k = (x_{1k}, x_{2k}, \dots, x_{Jk})^\top$.
		\end{itemize}
	\end{columns}}
\only<2>{
\begin{columns}
		\column{.6\linewidth}
		\begin{center}
			\begin{tikzpicture}
			\draw[teal][ultra thick] (0,0) ellipse (2.8cm and 1.8cm)
			node[text=teal,right=1.5cm,below=0.7cm]  {$s_r(n_r)$}
			node[text=teal,right=1cm,below=0cm]  {\color{teal}\Strichmaxerl[2]}
			node[text=teal,right=-1.2cm,below=-0.5cm]  {\color{teal}\Strichmaxerl[2]}
			node[text=teal,right=0cm,below=-1.4cm]  {\color{teal}\Strichmaxerl[2]}
			node[text=teal,right=-0.5cm,below=0.5cm]  {\color{teal}\Strichmaxerl[2]}
			node[text=teal,right=1.5cm,below=-1cm]  {\color{teal}\Strichmaxerl[2]};
			\draw[blue][ultra thick] (-3.5,-2.5) rectangle (3.5,2.5)
			node[text=blue,left=-0.5cm,below=-0.2cm] {$U(N)$}
			node[text=red,left=1cm,below=4cm] {$s_m(n_m)$}
			node[text=red,right=-1cm,below=0.2cm]  {\color{red}\Strichmaxerl[2]}
			node[text=red,right=-6cm,below=0.4cm]  {\color{red}\Strichmaxerl[2]}
			node[text=red,right=-6.4cm,below=3.8cm]  {\color{red}\Strichmaxerl[2]};
			\end{tikzpicture}
		\end{center}
		\column{.4\linewidth}
		\begin{itemize}
			\item[\LARGE\color{teal}\Strichmaxerl]  Respondent: \\
			$\color{teal} {\bf x}_k = (x_{1k}, x_{2k}, \dots, x_{Jk})^\top$ is fully observed.
			\item[\LARGE\color{red}\Strichmaxerl]  Non-respondent: \\
			$\color{red} {\bf x}_k = (x_{1k}, x_{2k}, \dots, x_{Jk})^\top$ contains at least one missing or not usable value.
		\end{itemize}
	\end{columns}}
\end{frame}

% \begin{frame}{Introduction to the non-response}
%     There are different types of non-response:
%     \begin{itemize}
%         \item The \hl{total non-response}.
%         \only<1>{
%             \textcolor{gray}{{\small\begin{table}\begin{tabular}{ccc}
% 					Sexe & Taille & Poids \\
% 					\hline
% 					H  	 & 175    &  68   \\
% 					F  	 & 160    & 55	  \\
% 					\textcolor{red}{?}  	 & \textcolor{red}{?}    & \textcolor{red}{?}    \\
% 					\textcolor{red}{?}  	 & \textcolor{red}{?}    & \textcolor{red}{?}    \\
% 			\end{tabular}\end{table}}}
% 		}
% 		\pause
% 		\item The \hl{partial non-response}.
% 		\only<2-3>{
% 		\begin{itemize}
% 		    \item \textit{Only one variable contains non-response}
%     			\only<2>{:
%     			\textcolor{gray}{\small\begin{table}\begin{tabular}{ccc}
%     						Sexe & Taille & Poids \\
%     						\hline
%     						H  	 & 175    &  68   \\
%     						F  	 & 160    & 55	  \\
%     						H  	 & 180    & \textcolor{red}{?}    \\
%     						F  	 & 165    & \textcolor{red}{?}    \\
%     			\end{tabular}\end{table}}
%     			}
%     			\pause
%     		\item \textit{Several or all variables contains non-response}
% 			\textcolor{gray}{:
% 			\begin{columns}
% 				\column{.6 \linewidth} {\small\begin{table}\begin{tabular}{ccccc}
% 							Sexe & Taille & P$_{t=1}$ & P$_{t=2}$ & P$_{t=3}$ \\
% 							\hline
% 							H  	 & 175    &  68 &  67 &  68   \\
% 							F  	 & 160    & 55	  & 58	 & \textcolor{red}{?}	 \\
% 							H  	 & 180    & 70  & \textcolor{red}{?} & \textcolor{red}{?}   \\
% 							F  	 & 165    & \textcolor{red}{?}  & \textcolor{red}{?} & \textcolor{red}{?}   \\
% 				\end{tabular}\end{table}}
% 			%se prete bien aux etudes longitudinales
% 				\vspace{0.2cm}\center{\it \bf Monotone}
% 				\column{.5 \linewidth}  {\small\begin{table}\begin{tabular}{ccc}
% 							Sexe & Taille & Poids  \\
% 							\hline
% 							H  	 & 175    &  68    \\
% 							F  	 & 160    & \textcolor{red}{?}	 	 \\
% 							H  	 & \textcolor{red}{?}    & 70     \\
% 							\textcolor{red}{?}  	 & 165    & \textcolor{red}{?}    \\
% 				\end{tabular}\end{table}}
% 			%fromage suisse, des trous partout
% 				\vspace{0.2cm}\center{\it \bf Not monotone}
% 			\end{columns}}
% 		\end{itemize}
% 		}
%     \end{itemize}
% \end{frame}

\begin{frame}{The swiss cheese nonresponse}
    The \hl{swiss cheese nonresponse} is:
    \begin{itemize}
        \item not monotone (i.e. without any pattern).
        \item contained in several or all variables.
    \end{itemize}
    \pause
    \textit{Idea}: generalize the method for the univariate nonresponse of \citet{hasl:till:2016} to the multivariate one. \vspace{3mm}
    \pause
    \begin{columns}
		\column{.5 \linewidth}
        \only<4->{
            \begin{figure}[t]
        		\centering
        		\includegraphics[height=0.90in]{./images/slice_Cheese.png}
        		\caption{The univariate case: a slice of swiss cheese with holes.}
            \end{figure}
            }
        \column{.5 \linewidth}
        \only<5>{
            \begin{figure}[t]
        		\centering
        		\includegraphics[height=0.90in]{./images/Swiss-Cheese.jpg}
        		\caption{The multivariate case: a swiss cheese with holes.}
            \end{figure}
            }
    \end{columns}
\end{frame}


% \begin{frame}{Objective}
%     What properties do we want to satisfy in an imputation method?
%     \begin{itemize}
%         \item Preserve the distribution of the variables.
%         \item Preserve the relationships between the variables.
%         \item Impute by realistic values.
%     \end{itemize}
%     \pause
%     What are the characteristics of the \hl{Balanced K-nearest neighbor CITE} imputation method?
%     \begin{itemize}
%         \item impute only one variable. \pause
%         \item is a donor imputation method with only one donor per non-respondent. \pause
%         \item impute each non-respondent by a similar unit. \pause
%         \item if the observed values had been imputed, the estimator would remain the same as for the observed values without imputation. \pause
%     \end{itemize}
%     \textcolor{red}{IDEA}: extend this imputation method for swiss cheese non-response.
% \end{frame}

\subsection{Notations of swiss cheese nonresponse}
\begin{frame}{Notations of swiss cheese nonresponse}
	\begin{columns}
		\column{.7 \linewidth} \begin{itemize}
			\item Population $U$ of size $N$.
			\item \textcolor{orange}{$J$} variables of interest. \\
			\item Sample $\textcolor{blue}{S} \subset U$ of size $\color{blue} n$.
			\item $\pi_k$ inclusion probabilities of $k \in S$.
			\item For each unit $k \in S$:
			$\xb_k=(x_{k{\color{orange}1}}, \dots, x_{k{\color{orange}j}}, \dots, x_{k{\color{orange}J}})^\top$.
			\only<2->{
			\\
			\hrulefill
			\item Sample $\color{teal}S_r$ $\subset \color{blue}S$ of size $\color{teal}n_r$ contains completely observed units.
			\item Sample $\color{red}S_m$ $\subset \color{blue}S$ of size $\color{red}n_m$ contains units with at least one missing or not usable value.
			\item $\color{teal}S_r$ $\cup \color{red}S_r$ $= \color{blue}S$ and $\color{teal}n_r+$ $ \color{red}n_m$ $=\color{blue}n$.
			\item Not monotone nonresponse.}
		\end{itemize}
		\column{.4 \linewidth}
		 \begin{center}
		 	\begin{tikzpicture}
		 	% Grand rectangle
		 	\draw[blue][ultra thick] (-1.2,-2.5) rectangle (1.2,2.5);
		 	% commentaires variables/unites
		 	\node at (0,3.2) {\textbf{Dataset}};
		 	\node at (-0.8,2.8) {$\color{orange}1$};
		 	\node at (0,2.8) {$\color{orange}2$};
		 	\node at (0.8,2.8) {$\color{orange}3$};
		 	%
		 	%	\node at (-3,0) {Units};
		 	\node at (-1.4,2.3) {$\color{blue}1$};
		 	\node at (-1.4,1) {$\color{blue}\vdots$};
		 	\node at (-1.4,0) {$\color{blue}k$};
		 	\node at (-1.4,-1) {$\color{blue}\vdots$};
		 	\node at (-1.4,-2.3) {$\color{blue}n$};
		 	%
		 	% bandes verticales
		 	\draw[darkgray][thick] (-0.4,-2.5) rectangle (0.4,2.5) ;
		 	%
		 	%
		 	\only<2->{
		 	% bande horizontale
		 	\draw[darkgray][ultra thick] (-1.2,0.5) -- (1.2,0.5);
		 	% rectangles remplis
		 	\fill[lightgray] (-1.165,-2.470) rectangle (-0.42,-1.0) ;
		 	\fill[lightgray] (-0.38,-1.75) rectangle (0.38,-0.25);
		 	\fill[lightgray] (0.42,0.475) rectangle (1.168,-0.8) ;
		 	\fill[lightgray] (0.42,-2.1) rectangle (1.168,-1.75) ;
		 	% accolades nm nr
		 	\node at (1.5,1.5) [xscale=1.5,yscale=5] {$\color{teal}\}$};
		 	\node at (2,1.5) {$\color{teal}S_r$};
		 	\node at (1.5,-1) [xscale=1.5,yscale=8.5] {$\color{red} \}$};
		 	\node at (2,-1) {$\color{red} S_m$};
		 	%
		 	}
		 	\end{tikzpicture}
		 \end{center}
	\end{columns}
\end{frame}

\section{Imputation method}
\subsection{Requirements of the imputation method}
\begin{frame}{Requirements of the imputation method}
	\begin{columns}
		\column{.75 \linewidth}
		Properties required for an imputation method:
        \begin{itemize}
            \item Impute by realistic values. \onslide<3->{\textcolor{green}{\checkmark}}
            \item Preserve the distribution of the variables.
            \onslide<4->{\textcolor{green}{\checkmark}}
            \item Preserve the relationships between the variables.
            \onslide<2->{\textcolor{green}{\checkmark}}
        \end{itemize}
        \pause
        Requirements of our method:
		\begin{enumerate}[(i)]
            \onslide<2->{
            \item \label{r1}
            Donor imputation method: choose one donor for each nonrespondent in $S_m$ among units in $S_r$ to impute its missing values.
            }
            %valeurs plausibles + preserve distribution
            \onslide<3->{
            \item \label{r2}
            Each donor should be selected among the $K$ nearest respondents of each nonrespondent unit.
            }
            %preserve relations
            \onslide<4->{
            \item \label{r3}
            If the observed values of the nonrespondents were imputed, the total estimator of each variable should remain unchanged.
            }
            %imputation par unites semblables, donc coherence valeurs observees/imputees
            %assure que l'information connue (observee) est preservee
        \end{enumerate}
        \column{.35 \linewidth}
        \begin{center}
        \begin{tikzpicture}
			% rectangles remplis
			\fill[lightgray] (-1.2,-2.5) rectangle (-0.4,-1.0) ;
			\fill[lightgray] (-0.4,-1.75) rectangle (0.4,-0.25);
			\fill[lightgray] (0.4,0.5) rectangle (1.2,-0.8) ;
			\fill[lightgray] (0.4,-2.1) rectangle (1.2,-1.3) ;
			% bandes verticales
			\draw[darkgray][thick] (-0.4,-2.5) rectangle (0.4,2.5) ;
			% bande verticale
			\draw[darkgray][ultra thick] (-1.2,0.5) -- (1.2,0.5);
			% Grand rectangle
			\draw[blue][ultra thick] (-1.2,-2.5) rectangle (1.2,2.5);
			% points dans rectangle
			\node at (1.5,-1) [xscale=1.5,yscale=8.5] {$\color{red} \}$};
			\node at (2,-1) {$\color{red} S_m$};
			\node at (1.5,1.5) [xscale=1.5,yscale=5] {$\color{teal}\}$};
			\node at (2,1.5) {$\color{teal}S_r$};
			%
			% commentaires variables/unites
			\node at (0,3.2) {\textbf{Dataset}};
			\node at (-0.8,2.8) {$\color{orange}1$};
			\node at (0,2.8) {$\color{orange}2$};
			\node at (0.8,2.8) {$\color{orange}3$};
			%
			%	\node at (-3,0) {Units};
			\node at (-1.4,2.3) {$\color{blue}1$};
			\node at (-1.4,1) {$\color{blue}\vdots$};
			\node at (-1.4,0) {$\color{blue}k$};
			\node at (-1.4,-1) {$\color{blue}\vdots$};
			\node at (-1.4,-2.3) {$\color{blue}n$};
			%
			\draw[teal][thick] (-1.3,1.5) rectangle (1.3,1.7) ;
			\draw[red][thick] (-1.3,-0.4) rectangle (1.3,-0.6) ;
			\fill[red] (-0.4,-0.4) rectangle (1.2,-0.6) ;
			\draw[darkgray] (0.4,-0.4) rectangle (0.4,-0.6) ;
			\draw[darkgray] (-0.4,-0.4) rectangle (-0.4,-0.6) ;
		\end{tikzpicture}
		\end{center}
	\end{columns}
\end{frame}

\subsection{Imputation probabilities}
\begin{frame}{Imputation probabilities}
\begin{itemize}
    \item[-]
    Let $\psib=(\psi_{uv})$ denote the matrix of size $n_r \times n_m$ containing imputation probabilities, where $(u,v)\in S_r \times S_m$. \\
    \item[-]
    $\psi_{uv}$: probability that the respondent $u\in S_r$ gives its values to the nonrespondent $v\in S_m$.
    \only<1>{
    \vspace{0.5cm}
	$$ {\boldsymbol \psi} \quad = \quad
	\begin{array}{@{}c@{\hspace{1ex}}c@{}}
		& \text{\color{red}Nonrespondents} \\[0.5ex]
		\rotatebox[origin=c]{90}{\text{\color{teal} Respondents}}
		&\begin{pmatrix}
		\psi_{11} & \psi_{12} & \psi_{13} \\
		\psi_{21} & \psi_{22} & \psi_{23} \\
		\psi_{31} & \psi_{32} & \psi_{33} \\
		\psi_{41} & \psi_{42} & \psi_{43} \\
		\end{pmatrix}
	\end{array}
	$$
    } \\
    \pause
    Constraints on $\psib$: \pause
	\begin{enumerate}
        \onslide<3->{
        \item
        Each nonrespondent must be imputed by only one respondent:
		$$ \sumisr \psi_{uv} = 1. $$
        }
        \onslide<4->{ \vspace{-0.4cm}
		\item
		Each donor selected among the $K$ nearest neighbors of each nonrespondent unit:
		$$ \psi_{uv} = 0  \ \text{if} \ u \notin \mbox{knn}(v) $$
		where $\mbox{knn}(\ell)=\left\{u\in s_r \mid \mbox{rank}(d(u,v))\leq K \right\}$ and $d(.,.)$ is a distance function.
		}
	\end{enumerate}
	%\end{adjustwidth}
\end{itemize}
\end{frame}

\begin{frame}{Imputation probabilities}
    \begin{enumerate}
        \item[3.] If the observed values of the nonrespondents were imputed, the total estimator of each variable should remain unchanged:
        $$\displaystyle \sum_{v \in S_m} r_{vj} \sumisr \psi_{uv}x_{uj} = \sum_{v \in S_m} r_{vj}x_{vj},$$
        where $r_{vj}$ is 1 if unit $v$ responded to variable $j$ and 0 otherwise. \pause
        \only<2>{
        \begin{columns}
		\column{.3 \linewidth}
		\begin{center}
		    \begin{tikzpicture}[scale=0.5]
        		% Grand rectangle
        		\draw[blue][ultra thick] (-0.6,-4) rectangle (0.6,4);
        		% bande horizontale
        		\draw[darkgray][ultra thick] (-0.6,0.5) -- (0.6,0.5);
        		% commentaires variables/unites
        		\node at (0,5) {{\textit{Variable}}};
        		\node at (0,4.35) {$\color{orange}1$};
        		%\node at (-3,0) {Units};
        		\node at (-1,3.5) {$\color{blue}1$};
        		\node at (-1,2.5) {$\color{blue}\vdots$};
        		\node at (-1,0) {$\color{blue}k$};
        		\node at (-1,-2.5) {$\color{blue}\vdots$};
        		\node at (-1,-3.6) {$\color{blue}n$};
        		% rectangles remplis
        		\fill[lightgray] (-0.53,-3.96) rectangle (0.56,-1.8) ;
        % 		% Sm Sr units
        % 		\node at (-1.4,2.3) [xscale=1.0,yscale=4] {$\{$};
        % 		\node at (-2,2.3) {$S_r$};
        % 		\node at (-1.4,-1.8) [xscale=1.0,yscale=5] {$ \{$};
        % 		\node at (-2,-1.8) {$ S_m$};
        % 		% rk
        		\draw[gray][thick] (0.8,3.9) -- (1.1,3.9);
        		\draw[gray][thick] (0.8,-1.75) -- (1.1,-1.75);
        		\draw[gray][thick] (1.1,-1.75) -- (1.1,3.9);
        		\draw[gray][->][thick] (1.1,1.08) -- (1.6,1.08);
        		\node at (2.5,1.08) {$r_{k1}=1$};

        		\draw[gray][thick] (0.8,-1.87) -- (1.1,-1.87);
        		\draw[gray][thick] (0.8,-3.93) -- (1.1,-3.93);
        		\draw[gray][thick] (1.1,-3.93) -- (1.1,-1.87);
        		\draw [->][gray][thick] (1.1,-2.93) -- (1.6,-2.93);
        		\node at (2.5,-2.93) {$r_{k1}=0$};
		    \end{tikzpicture}
	    \end{center}%
	    \column{.3 \linewidth}
	    \begin{center}
		    \begin{tikzpicture}[scale=0.5]
        		% Grand rectangle
        		\draw[blue][ultra thick] (-0.6,-4) rectangle (0.6,4);
        		% bande horizontale
        		\draw[darkgray][ultra thick] (-0.6,0.5) -- (0.6,0.5);
        		% commentaires variables/unites
        		\node at (0,5) {{\textit{Variable}}};
        		\node at (0,4.35) {$\color{orange}1$};
        		%\node at (-3,0) {Units};
        		\node at (-1,3.5) {$\color{blue}1$};
        		\node at (-1,2.5) {$\color{blue}\vdots$};
        		\node at (-1,0) {$\color{blue}k$};
        		\node at (-1,-2.5) {$\color{blue}\vdots$};
        		\node at (-1,-3.6) {$\color{blue}n$};
        		% rectangles remplis
        		\fill[lightgray] (-0.56,-3.96) rectangle (0.57,-1.8) ;
        		% Sm Sr units
        		%\node at (-1.4,2.3) [xscale=1.0,yscale=6.1] {$\{$};
        		%\node at (-2,2.3) {$S_r$};
        		%\node at (-1.4,-1.8) [xscale=1.0,yscale=8] {$ \{$};
        		%\node at (-2,-1.8) {$ S_m$};

        		% equation
        		\draw[darkgray][ultra thick] (-0.75,-1.9) rectangle (0.75,0.6) ;
        		\draw [->][darkgray][thick] (0.8,-0.65) -- (1.45,-0.65);
        		\node at (2.8,-0.65) {$\displaystyle \sum_{v \in S_m} r_{v1}x_{v1}$};
		    \end{tikzpicture}
	    \end{center}%
	    \column{.3 \linewidth}
	    \begin{center}
		    \begin{tikzpicture}[scale=0.5]
        		% Grand rectangle
        		\draw[blue][ultra thick] (-0.6,-4) rectangle (0.6,4);
        		% bande horizontale
        		\draw[darkgray][ultra thick] (-0.6,0.5) -- (0.6,0.5);
        		% commentaires variables/unites
        		\node at (0,5) {{\textit{Variable}}};
        		\node at (0,4.35) {$\color{orange}1$};
        		%\node at (-3,0) {Units};
        		\node at (-1,3.5) {$\color{blue}1$};
        		\node at (-1,2.5) {$\color{blue}\vdots$};
        		\node at (-1,0) {$\color{blue}k$};
        		\node at (-1,-2.5) {$\color{blue}\vdots$};
        		\node at (-1,-3.6) {$\color{blue}n$};
        		% rectangles remplis
        		\fill[lightgray] (-0.56,-3.96) rectangle (0.57,-1.8) ;
        		% Sm Sr units
        		%\node at (-1.4,2.3) [xscale=1.0,yscale=6.1] {$\{$};
        		%\node at (-2,2.3) {$S_r$};
        		%\node at (-1.4,-1.8) [xscale=1.0,yscale=8] {$ \{$};
        		%\node at (-2,-1.8) {$ S_m$};

        		% hachted region
        		\draw[-] (-0.6,0.15) -- (-0.4,0.5);
        		\draw[-] (-0.6,-0.2) -- (-0.2,0.5);
        		\draw[-] (-0.6,-0.6) -- (0,0.5);
        		\draw[-] (-0.6,-1) -- (0.2,0.5);
        		\draw[-] (-0.6,-1.367) -- (0.4,0.5);

        		\draw[-] (-0.6,-1.8) -- (0.6,0.5);
        		\draw[-] (-0.4,-1.8) -- (0.6,0.067);
        		\draw[-] (-0.2,-1.8) -- (0.6,-0.35);
        		\draw[-] (0,-1.8) -- (0.6,-0.72);
        		\draw[-] (0.2,-1.8) -- (0.6,-1.1);
        		\draw[-] (0.4,-1.8) -- (0.6,-1.45);
        		% equation
        		\draw[darkgray][ultra thick] (-0.75,-1.9) rectangle (0.75,0.6) ;
        		\draw [->][darkgray][thick] (0.76,-0.65) -- (1.45,-0.65);
        		\node at (2.8,-0.65) {$\displaystyle \sum_{v \in S_m}r_{v1} x^*_{v1} $};
		    \end{tikzpicture}
	   \end{center}
    \end{columns}
    }
    \end{enumerate}
    \vspace{0.2cm}
    %where $x^*_{v1} = \sum_{u \in S_r} \psi_{uv} x_{u1}$.
    \pause
    \only<3->{
    \begin{itemize}
        \item
        Probabilities in matrix $\psib$ are initialized for each nonrespondent $u$:
        \begin{align}
            \psi_{uv} =
            \begin{cases}
                 \frac{1}{K}	 & \text{if}\ u\in \mbox{knn}(v), \\
                0    & \text{otherwise}.
            \end{cases}
        \end{align}
        \item
        Matrix $\psib$ is updated using an algorithm of calibration proposed by \citet{dev:sar:92} in order to verify requirements 1-3.
    \end{itemize}
    }
\end{frame}

\subsection{Imputation matrix}
\begin{frame}{Imputation matrix}
    \begin{columns}
		\column{0.5\textwidth}
		Matrix of imputation probabilities:
		$$ {\boldsymbol \psi} = \begin{pmatrix}
		0 & 0.5 & 0.5 \\
		0.5 & 0.5 & 0 \\
		0.3 & 0 & 0.4 \\
		0.2 & 0 & 0.1 \\
		\end{pmatrix} $$
		\column{0.5\textwidth}
		Imputation matrix:
		$$ {\boldsymbol \phi} = \begin{pmatrix}
		0 & 1 & 1 \\
		1 & 0 & 0 \\
		0 & 0 & 0 \\
		0 & 0 & 0 \\
		\end{pmatrix} $$
	\end{columns} ~\\
	\pause
    \begin{itemize}
        \item
        Imputation matrix computed using a stratified sampling method:
        \begin{itemize}
            \item[-] Columns of $\psib$ correspond to stratum.
            \item[-] Balancing constraints: respect requirement 3.
        \end{itemize}
        \item Element $\psi_{uv} = 1$ signifies that missing values of nonrespondent $v$ will be imputed by values of respondent $u$:
        $$
        x_{uj}^* = \sum_{v\in S_r} \phi_{uv} x_{vj}.
        $$
    \end{itemize}
\end{frame}

\section{Example with the R software}
\begin{frame}[fragile]{Example with the R software}
$\rightarrow$ SwissCheese package available on github: \textit{URL SWISS CHEESE}
<<include=FALSE, echo=TRUE,fig.height=3,fig.width=3>>=
library(fastDummies)
library(sampling)
library(bannerCommenter)
library(StratifiedSampling)
N  <- 150
##---Gamma variables
g1 <- rgamma(N, shape = 7, rate = 0.2)
g2 <- rgamma(N, shape = 5, rate = 0.4)

##---Correlated variables from the gamma variables
V1 <- g1
V2 <- g1+g2
V3 <- (g1>35)*1
cor(cbind(V1,V2,V3))
##---Final data set
X <- cbind(V1,V2,V3)
J <- ncol(X)


#----pp: probabilitï¿½s de rï¿½ponse pour chaque variable
pp <- matrix(rep(0,N*J), c(N,J))
for(j in 1:J){
  if((j %% 2) != 0){
    pp[,j] <- 1 / (1 + exp(-0.075* X[, 1]))
  }else{
    pp[,j] <- 1 / (1 + exp(-0.055 * X[, 2]))
  }
}

generateNA <- function(X, pp, nr_min)
{
  #----Response indicator matrix: r
  nr <- 1
  r  <- matrix(rep(0,N*J), c(N,J))
  while(nr < nr_min) {
    for(j in 1:J){
      r[,j] <- UPpoisson(pp[,j])
    }
    nr <- sum(rowSums(r) == J)			# Number of respondent
  }
  #----Add NA to matrix X
  for(i in 1:ncol(X)){
    X[r[,i] == 0,i] <- NA
  }
  return(X)
}
X_NA <- generateNA(X, pp, nr_min = 10)
@

<<include=TRUE, echo=TRUE,fig.height=3,fig.width=3>>=
# Download the package SwissCheese
devtools::load_all("C:/Users/eustachee/switchdrive/Swiss cheese/subject_1/SwissCheese/R")
# Dataframe with NA values
## LOADING
# Number of units
nrow(X_NA)
# Number of nonrespondents
nrow(X_NA)-nrow(na.omit(X_NA))
@
\end{frame}

\begin{frame}[fragile]
<<include=TRUE,echo=TRUE,results='hide',fig.height=3,fig.width=3,message=FALSE,warning=FALSE,error=FALSE>>=
## Swiss cheese imputation ##
SW <- swissCheeseImput(X = X_NA, d = NULL, k = NULL,
                      tol = 1e-3, max_iter = 50)
@

<<include=TRUE, echo=TRUE,fig.height=3,fig.width=3>>=
###---Optimal number of neighbors considered
SW$k
###---The imputed dataframe
X_imput <- SW$X
sum(is.na(X_imput))
@
\end{frame}

\begin{frame}{Bibliography}
\bibliography{references}
\bibliographystyle{apalike}
\end{frame}

\end{document}
